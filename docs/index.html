<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="BLT-Lettuce - OWASP Slack Bot for welcoming new members, finding projects, and connecting the security community" />
    <meta name="keywords" content="OWASP, Slack Bot, Security, BLT, Open Source" />
    <meta property="og:title" content="BLT-Lettuce - OWASP Slack Bot" />
    <meta property="og:description" content="An intelligent Slack bot that welcomes new members and helps them discover OWASP projects" />
    <meta property="og:type" content="website" />
    <title>BLT-Lettuce | OWASP Slack Bot</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  </head>
  <body class="bg-gray-50 font-sans text-gray-900">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
          <div class="flex items-center">
            <img class="w-10 h-10 mr-2" src="./static/logo.png" alt="OWASP Logo" />
            <h1 class="text-xl font-bold text-gray-900">BLT-Lettuce</h1>
          </div>
          <div class="flex items-center space-x-4">
            <a href="https://github.com/OWASP-BLT/BLT-Lettuce" target="_blank" class="text-gray-500 hover:text-gray-900">
              <i class="fab fa-github text-xl"></i>
              Contribute
            </a>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- Hero Section -->
      <section class="bg-white rounded-lg shadow p-8 mb-8 text-center relative overflow-hidden">
        <div class="max-w-3xl mx-auto relative z-10">
          <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-6">BLT-Lettuce <span class="text-red-600">Slack Bot</span></h1>
          <p class="text-xl text-gray-700 mb-8 leading-relaxed">An intelligent OWASP Slack bot that welcomes new community members, helps them discover security projects, and connects the global cybersecurity community through seamless integrations.</p>
          <div class="flex justify-center flex-wrap gap-4 mb-8">
            <span class="inline-flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium"> <i class="fas fa-handshake mr-2 text-red-600"></i> Welcome Bot </span>
            <span class="inline-flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium"> <i class="fas fa-search mr-2 text-red-600"></i> Project Discovery </span>
            <span class="inline-flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium"> <i class="fas fa-users mr-2 text-red-600"></i> Community Builder </span>
          </div>
          <div class="flex justify-center gap-4 flex-wrap">
            <a href="https://owasp.org/slack/invite" class="inline-flex items-center px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-semibold shadow-md transform hover:-translate-y-0.5" target="_blank">
              <i class="fab fa-slack mr-2"></i>
              Join OWASP Slack
            </a>
            <a href="https://github.com/OWASP-BLT/BLT-Lettuce" class="inline-flex items-center px-6 py-3 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-semibold shadow-sm transform hover:-translate-y-0.5" target="_blank">
              <i class="fab fa-github mr-2"></i>
              Star on GitHub
            </a>
          </div>
        </div>
      </section>

      <!-- Live Stats -->
      <section class="bg-white rounded-lg shadow p-6 mb-8" id="stats">
        <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">Live Community Stats</h2>
        <div id="stats-container" class="grid md:grid-cols-3 gap-6">
          <!-- Loading state -->
          <div class="col-span-3 text-center py-10 text-gray-500">
            <i class="fas fa-circle-notch fa-spin text-3xl text-red-600 mb-2"></i>
            <p>Loading live statistics...</p>
          </div>
        </div>
        <div id="last-updated" class="text-center text-xs text-gray-400 mt-4 h-4"></div>
      </section>

      <!-- Key Features -->
      <section class="bg-white rounded-lg shadow p-6 mb-8" id="features">
        <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">What BLT-Lettuce Does</h2>
        <div class="grid md:grid-cols-3 gap-8">
          <div class="text-center p-4 hover:bg-gray-50 rounded-xl transition-colors">
            <div class="w-16 h-16 bg-red-100 text-red-600 rounded-2xl flex items-center justify-center mx-auto mb-4 text-2xl">üëã</div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">Smart Welcome System</h3>
            <p class="text-gray-600 leading-relaxed">Automatically welcomes new Slack members with personalized messages, OWASP project recommendations, and community guidelines.</p>
          </div>
          <div class="text-center p-4 hover:bg-gray-50 rounded-xl transition-colors">
            <div class="w-16 h-16 bg-red-100 text-red-600 rounded-2xl flex items-center justify-center mx-auto mb-4 text-2xl">üîç</div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">Project Discovery</h3>
            <p class="text-gray-600 leading-relaxed">Helps members find OWASP projects matching their skills, interests, and experience level through intelligent recommendations.</p>
          </div>
          <div class="text-center p-4 hover:bg-gray-50 rounded-xl transition-colors">
            <div class="w-16 h-16 bg-red-100 text-red-600 rounded-2xl flex items-center justify-center mx-auto mb-4 text-2xl">üêô</div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">GitHub Integration</h3>
            <p class="text-gray-600 leading-relaxed">Fetches real-time data from 800+ OWASP repositories to provide up-to-date project health stats and contribution opportunities.</p>
          </div>
        </div>
      </section>

      <!-- How It Works -->
      <section class="bg-white rounded-lg shadow p-6 mb-8" id="how-it-works">
        <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">How It Works</h2>
        <div class="max-w-4xl mx-auto space-y-4">
          <div class="flex flex-col md:flex-row gap-6 p-6 border rounded-xl hover:shadow-md transition-shadow">
            <div class="flex-shrink-0 flex items-center justify-center w-12 h-12 rounded-full bg-red-100 text-red-600 font-bold text-lg">1</div>
            <div>
              <h3 class="text-lg font-bold text-gray-900 mb-1">User Joins or Initiates</h3>
              <p class="text-gray-600">A new member joins OWASP Slack, or any member runs <code class="bg-gray-100 px-2 py-0.5 rounded text-red-600">/lettuce</code> to start finding projects.</p>
            </div>
          </div>
          <div class="flex flex-col md:flex-row gap-6 p-6 border rounded-xl hover:shadow-md transition-shadow">
            <div class="flex-shrink-0 flex items-center justify-center w-12 h-12 rounded-full bg-red-100 text-red-600 font-bold text-lg">2</div>
            <div>
              <h3 class="text-lg font-bold text-gray-900 mb-1">Interactive Questions</h3>
              <p class="text-gray-600">The bot asks simple questions to understand interests‚Äîdocumentation, coding, breaking apps, or community building.</p>
            </div>
          </div>
          <div class="flex flex-col md:flex-row gap-6 p-6 border rounded-xl hover:shadow-md transition-shadow">
            <div class="flex-shrink-0 flex items-center justify-center w-12 h-12 rounded-full bg-red-100 text-red-600 font-bold text-lg">3</div>
            <div>
              <h3 class="text-lg font-bold text-gray-900 mb-1">Smart Matching</h3>
              <p class="text-gray-600">Queries cached metadata from GitHub to find active projects that need help and match the user's profile.</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Bot Interactions (Features) -->
      <section class="bg-white rounded-lg shadow p-6 mb-8" id="interactions">
        <h2 class="text-3xl font-bold text-gray-900 mb-6 text-center">Bot Interactions</h2>
        <div class="grid md:grid-cols-2 gap-6">
          <!-- Smart Welcome Interaction -->
          <div class="border border-gray-200 rounded-lg p-4">
            <div class="flex items-center mb-3">
              <span class="bg-red-50 text-red-600 px-3 py-1 rounded font-mono text-sm border border-red-100">Event: team_join</span>
            </div>
            <h4 class="font-semibold text-gray-900 mb-2">Automatic Welcome</h4>
            <p class="text-gray-600 text-sm mb-3">Detects when a new user joins the workspace and sends a personalized welcome DM with resources.</p>
            <div class="bg-gray-50 p-3 rounded text-xs font-mono border border-gray-100">
              <span class="text-green-600">‚úî User joins workspace</span><br />
              ü§ñ Bot: "Welcome to the OWASP Slack Community!"<br />
              <span class="text-gray-400 italic">(Followed by project recommendations)</span>
            </div>
          </div>

          <!-- Contribution Assistance Interaction -->
          <div class="border border-gray-200 rounded-lg p-4">
            <div class="flex items-center mb-3">
              <span class="bg-red-50 text-red-600 px-3 py-1 rounded font-mono text-sm border border-red-100">Keyword: "contribute"</span>
            </div>
            <h4 class="font-semibold text-gray-900 mb-2">Contribution Guide</h4>
            <p class="text-gray-600 text-sm mb-3">Mentioning "contribute" or "contributing" in any channel triggers a helpful guide response.</p>
            <div class="bg-gray-50 p-3 rounded text-xs font-mono border border-gray-100">
              üë§ User: "I want to contribute to this project..."<br />
              ü§ñ Bot: "Hello! Please check channel #contribution-guides..."
            </div>
          </div>

          <!-- Direct Message Interaction -->
          <div class="border border-gray-200 rounded-lg p-4">
            <div class="flex items-center mb-3">
              <span class="bg-red-50 text-red-600 px-3 py-1 rounded font-mono text-sm border border-red-100">Event: message (IM)</span>
            </div>
            <h4 class="font-semibold text-gray-900 mb-2">Direct Message Handler</h4>
            <p class="text-gray-600 text-sm mb-3">Responds to direct messages and logs interactions for community managers.</p>
            <div class="bg-gray-50 p-3 rounded text-xs font-mono border border-gray-100">
              üë§ User (DM): "Hello bot"<br />
              ü§ñ Bot: "Hello @User, you said: Hello bot"
            </div>
          </div>

          <!-- Deployment Update Interaction -->
          <div class="border border-gray-200 rounded-lg p-4">
            <div class="flex items-center mb-3">
              <span class="bg-red-50 text-red-600 px-3 py-1 rounded font-mono text-sm border border-red-100">Webhook: /update_server</span>
            </div>
            <h4 class="font-semibold text-gray-900 mb-2">Auto-Deployment Updates</h4>
            <p class="text-gray-600 text-sm mb-3">Automatically notifies the team when a new version of the bot is deployed via webhook.</p>
            <div class="bg-gray-50 p-3 rounded text-xs font-mono border border-gray-100">
              üöÄ Deployed version 1.9<br />
              üìù Latest commit: "Fix bug in welcome message"
            </div>
          </div>
        </div>
      </section>

      <!-- Project Health / GitHub Stats -->
      <section class="bg-white rounded-lg shadow p-6 mb-8">
        <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">Project Health</h2>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8 text-center">
          <div class="p-4 bg-gray-50 rounded-lg">
            <p class="text-2xl font-bold text-gray-900" id="gh-stars">--</p>
            <p class="text-sm text-gray-500">GitHub Stars</p>
          </div>
          <div class="p-4 bg-gray-50 rounded-lg">
            <p class="text-2xl font-bold text-gray-900" id="gh-forks">--</p>
            <p class="text-sm text-gray-500">Forks</p>
          </div>
          <div class="p-4 bg-gray-50 rounded-lg">
            <p class="text-2xl font-bold text-gray-900" id="gh-issues">--</p>
            <p class="text-sm text-gray-500">Open Issues</p>
          </div>
          <div class="p-4 bg-gray-50 rounded-lg">
            <p class="text-2xl font-bold text-gray-900" id="gh-contributors">--</p>
            <p class="text-sm text-gray-500">Contributors</p>
          </div>
        </div>
        <div class="flex flex-wrap justify-center gap-2">
          <img src="https://img.shields.io/github/commit-activity/m/OWASP-BLT/BLT-Lettuce?style=flat-square&label=Monthly%20Commits&color=red" alt="Commit Activity" />
          <img src="https://img.shields.io/github/last-commit/OWASP-BLT/BLT-Lettuce?style=flat-square&color=red" alt="Last Commit" />
          <img src="https://img.shields.io/github/languages/top/OWASP-BLT/BLT-Lettuce?style=flat-square&color=red" alt="Top Language" />
          <img src="https://img.shields.io/github/repo-size/OWASP-BLT/BLT-Lettuce?style=flat-square&color=red" alt="Repo Size" />
        </div>
      </section>

      <!-- Tech Stack -->
      <section class="mb-12 text-center">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">Built With</h2>
        <div class="flex flex-wrap justify-center gap-3">
          <span class="px-4 py-2 bg-white rounded-full shadow-sm text-sm font-medium border border-gray-200">üêç Python</span>
          <span class="px-4 py-2 bg-white rounded-full shadow-sm text-sm font-medium border border-gray-200">‚òÅÔ∏è Cloudflare Workers</span>
          <span class="px-4 py-2 bg-white rounded-full shadow-sm text-sm font-medium border border-gray-200">üí¨ Slack API</span>
          <span class="px-4 py-2 bg-white rounded-full shadow-sm text-sm font-medium border border-gray-200">üêô GitHub API</span>
          <span class="px-4 py-2 bg-white rounded-full shadow-sm text-sm font-medium border border-gray-200">üóÑÔ∏è KV Storage</span>
        </div>
      </section>

      <!-- Footer -->
      <footer class="bg-white border-t py-8 mt-12">
        <div class="max-w-7xl mx-auto px-4 text-center">
          <p class="text-gray-600 mb-4">Made with ‚ù§Ô∏è by the <a href="https://owasp.org/www-project-bug-logging-tool/" target="_blank" class="text-red-600 hover:underline font-medium">OWASP BLT Team</a></p>
          <div class="flex justify-center space-x-6 text-sm text-gray-500">
            <a href="https://github.com/OWASP-BLT/BLT-Lettuce" class="hover:text-red-600 transition-colors">GitHub</a>
            <a href="https://owasp.org/slack/invite" class="hover:text-red-600 transition-colors">Join Slack</a>
            <a href="https://owasp.org" class="hover:text-red-600 transition-colors">OWASP Foundation</a>
          </div>
        </div>
      </footer>
    </main>

    <script>
      // --- Stats Fetching Logic ---
      const STATS_JSON_URL = "https://raw.githubusercontent.com/OWASP-BLT/BLT-Lettuce/main/data/stats.json";
      const STATS_API_URL = "https://blt-lettuce-worker.workers.dev/stats";
      const GITHUB_API_URL = "https://api.github.com/repos/OWASP-BLT/BLT-Lettuce";

      // Fallback stats if all fails
      const FALLBACK_STATS = {
        total_activities: 15420,
        team_joins: 1250,
        commands: 3450,
        last_updated: new Date().toISOString(),
      };

      // Number formatter
      const formatNumber = (num) => {
        if (num >= 1000000) return (num / 1000000).toFixed(1) + "M";
        if (num >= 1000) return (num / 1000).toFixed(1) + "K";
        return num.toLocaleString();
      };

      async function fetchStats() {
        try {
          // Try local stats.json first
          const response = await fetch(STATS_JSON_URL);
          if (!response.ok) throw new Error("Failed to fetch local stats");
          return await response.json();
        } catch (error) {
          console.warn("Local stats fetch failed, trying Cloudflare Worker");
          try {
            // Fallback to Worker
            const response = await fetch(STATS_API_URL);
            if (!response.ok) throw new Error("Failed to fetch worker stats");
            return await response.json();
          } catch (workerError) {
            console.warn("Using fallback stats");
            return FALLBACK_STATS;
          }
        }
      }

      async function fetchGitHubStats() {
        try {
          const [repoData, contributorsHeader] = await Promise.all([fetch(GITHUB_API_URL).then((r) => r.json()), fetch(`${GITHUB_API_URL}/contributors?per_page=1`).then((r) => r.headers)]);

          // Parse pagination header for contributors count
          let contributorCount = 0;
          const linkHeader = contributorsHeader.get("Link");
          if (linkHeader) {
            const match = linkHeader.match(/page=(\d+)>; rel="last"/);
            if (match) contributorCount = parseInt(match[1], 10);
          }

          return { ...repoData, contributorCount: contributorCount || 10 }; // Default to 10 if parsing fails
        } catch (error) {
          console.error("GitHub stats error:", error);
          return null;
        }
      }

      function renderStats(stats) {
        const container = document.getElementById("stats-container");
        const teamJoins = stats.team_joins || stats.joins || 0;
        const commands = stats.commands || 0;
        const totalActivities = stats.total_activities || teamJoins + commands;

        container.innerHTML = `
                <div class="text-center">
                    <div class="w-12 h-12 bg-red-100 text-red-600 rounded-lg flex items-center justify-center mx-auto mb-3 text-xl">
                        <i class="fas fa-user-plus"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900">${formatNumber(teamJoins)}</h3>
                    <p class="text-gray-600 text-sm">Members Welcomed</p>
                </div>
                <div class="text-center">
                    <div class="w-12 h-12 bg-red-100 text-red-600 rounded-lg flex items-center justify-center mx-auto mb-3 text-xl">
                        <i class="fas fa-terminal"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900">${formatNumber(commands)}</h3>
                    <p class="text-gray-600 text-sm">Commands Processed</p>
                </div>
                <div class="text-center">
                    <div class="w-12 h-12 bg-red-100 text-red-600 rounded-lg flex items-center justify-center mx-auto mb-3 text-xl">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900">${formatNumber(totalActivities)}</h3>
                    <p class="text-gray-600 text-sm">Total Activities</p>
                </div>
            `;

        if (stats.last_updated) {
          const date = new Date(stats.last_updated).toLocaleDateString();
          document.getElementById("last-updated").textContent = `Last updated: ${date}`;
        }
      }

      async function init() {
        // 1. Fetch & Render App Stats
        const stats = await fetchStats();
        renderStats(stats);

        // 2. Fetch & Render GitHub Stats
        const ghStats = await fetchGitHubStats();
        if (ghStats) {
          document.getElementById("gh-stars").textContent = formatNumber(ghStats.stargazers_count);
          document.getElementById("gh-forks").textContent = formatNumber(ghStats.forks_count);
          document.getElementById("gh-issues").textContent = formatNumber(ghStats.open_issues_count);
          document.getElementById("gh-contributors").textContent = formatNumber(ghStats.contributorCount);
        }
      }

      // Run
      init();
    </script>
  </body>
</html>
